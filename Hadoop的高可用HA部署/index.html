<!DOCTYPE html><html class="theme-next pisces" lang="zh-CN"><head><meta charset="UTF-8"><meta name="generator" content="Hexo 3.9.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0"><link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content=""><meta name="baidu-site-verification" content="8gbQ8pd371"><link rel="stylesheet" href="/css/main.css?v=7.3.0"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"7.3.0",exturl:!0,sidebar:{position:"right",display:"post",offset:12,onmobile:!1},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},save_scroll:!0,copycode:{enable:!0,show_result:!1,style:null},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:-1,unescape:!1,preload:!0},path:"search.xml",motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"}}</script><meta name="description" content="引言&amp;emsp;&amp;emsp;有基础的读者，可以直接跳到第三章：环境搭建。前面两章都是一些相关的理论基础和准备工作。而对于完全是第一次搭建Hadoop高可用HA集群的读者，强烈建议花几分钟看一看这些理论基础和准备工作，便于后面更好地理解和搭建集群环境。 理论分析&amp;emsp;&amp;emsp;本章将从进程间的通信机制RPC，Hadoop基础理论和ZooKeeper基础理论来阐述，首先对此有一定的理论理解基础"><meta name="keywords" content="Hadoop"><meta property="og:type" content="article"><meta property="og:title" content="Hadoop的高可用HA部署"><meta property="og:url" content="https://2694048168.github.io/Hadoop的高可用HA部署/index.html"><meta property="og:site_name" content="云主宰苍穹"><meta property="og:description" content="引言&amp;emsp;&amp;emsp;有基础的读者，可以直接跳到第三章：环境搭建。前面两章都是一些相关的理论基础和准备工作。而对于完全是第一次搭建Hadoop高可用HA集群的读者，强烈建议花几分钟看一看这些理论基础和准备工作，便于后面更好地理解和搭建集群环境。 理论分析&amp;emsp;&amp;emsp;本章将从进程间的通信机制RPC，Hadoop基础理论和ZooKeeper基础理论来阐述，首先对此有一定的理论理解基础"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-02-19T08:06:12.723Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hadoop的高可用HA部署"><meta name="twitter:description" content="引言&amp;emsp;&amp;emsp;有基础的读者，可以直接跳到第三章：环境搭建。前面两章都是一些相关的理论基础和准备工作。而对于完全是第一次搭建Hadoop高可用HA集群的读者，强烈建议花几分钟看一看这些理论基础和准备工作，便于后面更好地理解和搭建集群环境。 理论分析&amp;emsp;&amp;emsp;本章将从进程间的通信机制RPC，Hadoop基础理论和ZooKeeper基础理论来阐述，首先对此有一定的理论理解基础"><link rel="alternate" href="/atom.xml" title="云主宰苍穹" type="application/atom+xml"><link rel="canonical" href="https://2694048168.github.io/Hadoop的高可用HA部署/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>Hadoop的高可用HA部署 | 云主宰苍穹</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-right"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">云主宰苍穹</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish.</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益 404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header> <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tLzI2OTQwNDgxNjg=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></span><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content page-post-detail"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://2694048168.github.io/Hadoop的高可用HA部署/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="云主宰苍穹"><meta itemprop="description" content="云主宰苍穹,物联网,嵌入式、云计算、大数据、人工智能、机器学习"><meta itemprop="image" content="/images/liwei.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="云主宰苍穹"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Hadoop的高可用HA部署</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-08-18 22:20:24" itemprop="dateCreated datePublished" datetime="2019-08-18T22:20:24+08:00">2019-08-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-02-19 16:06:12" itemprop="dateModified" datetime="2020-02-19T16:06:12+08:00">2020-02-19</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Hadoop/" itemprop="url" rel="index"><span itemprop="name">Hadoop</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>17k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>16 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h4 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h4><p>&emsp;&emsp;有基础的读者，可以直接跳到第三章：环境搭建。前面两章都是一些相关的理论基础和准备工作。而对于完全是第一次搭建Hadoop高可用HA集群的读者，强烈建议花几分钟看一看这些理论基础和准备工作，便于后面更好地理解和搭建集群环境。</p><h4 id="理论分析"><a href="#理论分析" class="headerlink" title="理论分析"></a>理论分析</h4><p>&emsp;&emsp;本章将从进程间的通信机制RPC，Hadoop基础理论和ZooKeeper基础理论来阐述，首先对此有一定的理论理解基础，便于后面的环境快速搭建。<br>&emsp;&emsp;关于RPC、Hadoop和ZooKeeper的基础理论和角色说明，都只是简单的阐述一些基础理论和几个常见的角色，而不是只有这些角色，想要更加深入了解每一个模块的机制，了解每一个模块的工作机制和其对应的角色功能，可以查看Apache关于Hadoop的官方文档说明。</p><h5 id="RPC通信机制"><a href="#RPC通信机制" class="headerlink" title="RPC通信机制"></a>RPC通信机制</h5><p>&emsp;&emsp;Hadoop内部的所有通信机制都是采用RPC通信，每一个进程都有对应的RPC通信端口，与TCP和UDP的通信端口不同。注意区分RPC内部通信端口和HTTP通信端口。<br>&emsp;&emsp;RPC（Remote Procedure Call）—远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。<br>&emsp;&emsp;RPC采用客户机/服务器模式。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。<br>&emsp;&emsp;有多种 RPC模式和执行。最初由 Sun 公司提出。IETF ONC 宪章重新修订了 Sun 版本，使得 ONC RPC 协议成为 IETF 标准协议。现在使用最普遍的模式和执行是开放式软件基础的分布式计算环境（DCE）。</p><h5 id="Hadoop基础理论"><a href="#Hadoop基础理论" class="headerlink" title="Hadoop基础理论"></a>Hadoop基础理论</h5><p>&emsp;&emsp;Hadoop就是一个分布式计算的解决方案，也就是帮助我们把一个任务分到很多台计算机来计算。Hadoop是Apache基金会开源的一个框架，可编写和运行分布式应用处理大规模数据，是专为离线和大规模数据分析而设计的，并不适合那种对几个记录随机读写的在线事务处理模式。<br><span class="exturl" data-url="aHR0cDovL2hhZG9vcC5hcGFjaGUub3JnLw==" title="http://hadoop.apache.org/">Apache关于Hadoop简介点击这里<i class="fa fa-external-link"></i></span><br><strong>Hadoop1.x版本：分布式文件系统(HDFS)和分布式计算框架(MapReduce)</strong><br><strong>Hadoop2.x版本：分布式文件系统(HDFS)、分布式计算框架(MapReduce)和分布式资源调度(YARN)</strong><br><strong>Hadoop3.x版本：HDFS+MapReduce+YARN，在2.x版本上进行一系列的更改。<span class="exturl" data-url="aHR0cHM6Ly9oYWRvb3AuYXBhY2hlLm9yZy9kb2NzL3IzLjAuMC8=" title="https://hadoop.apache.org/docs/r3.0.0/">详细的更改文档请点击这里<i class="fa fa-external-link"></i></span></strong><br>&emsp;&emsp;分布式文件系统HDFS是主从架构模型系统，一个HDFS集群和GFS文件系统集群一样有Master和Slave两种角色，而HDFS的Master就是NameNode(NN)，在HDFS中还有一个SecondaryNameNode角色，Slave就是DataNode(DN)，其NameNode的作用就是管理整个文件系统的命令空间（储存数据的索引）和客户端对文件的访问（建立文件系统与外界进行交流），而Slave的作用就是以块的形式真正的储存数据。块(Block)是分布式文件系统的文件储存的逻辑单元，每一个块有对个副本（在不同的DataNode）上以达到容错效果。<br>&emsp;&emsp;分布式计算框架MapReduce是一个并行的编程计算框架，主要思想是将一个任务拆分为多个Mapper和Reducer阶段，从而达到一个输入一个输出，而却是分布式的计算处理，提高效率和利用率。<br>&emsp;&emsp;分布式资源调度YARN可以理解类似HDFS理解，也是一个主从架构模型，一个YARN有ResouceManager和NodeManager，分别映射YARN物理节点的主节点（资源调度和分配）和计算节点（常与DataNode一起）。ResourceManager节点的功能由Secheduler和ApplicationManager协调完成。NodeManager对应集群中的计算节点，但是他的功能仅仅只是抽象本节点的资源(如cpu，内存，磁盘，网络)并且定时向ResourceManager的Secheduler汇报。</p><h5 id="ZooKeeper基础理论"><a href="#ZooKeeper基础理论" class="headerlink" title="ZooKeeper基础理论"></a>ZooKeeper基础理论</h5><p>&emsp;&emsp;ZooKeeper是一个分布式的协调框架，主要的分布式特性：顺序一致性、原子性、单一视图、可靠性、实时性。<br>&emsp;&emsp;简单来说ZooKeeper使得分布式程序能够通过一个共享的、树形结构的名字空间来进行相互协调，组成这个树形结构的数据节点被称作ZNode，它们之间的层级关系就像文件系统的目录结构一样；构建集群，也就是Zookeeper服务的可复制性，一般3-5(奇数)台机器就可以构建一个Zookeeper的集群，只要确保一半以上的服务器能够正常工作，整个机器就能够正常对外服务。相互之间可以进行通信，在内存中维护当前服务器状态，客户可以与任意一台服务器建立TCP连接进行通信，当与此服务器连接断开之后，客户端会自动连接到集群中的其他服务器继续工作；顺序访问，客户端的每一个更新请求ZooKeeper都会分配一个全局唯一的递增编号，通过这个编号可以确保事物操作的先后顺序；高性能，ZooKeeper将全量数据存储于内存之中，并直接服务于客户端的所有非事物请求，因此在读操作的应用上优势更为明显。可以在千台服务器组成的读写比例大约为10:1的分布系统上表现优异。<br>&emsp;&emsp;ZooKeeper的角色说明，主要有Leader(领导者)，其作用是为客户端提供读和写的服务，负责投票的发起和决议，更新系统状态；Follower（跟随者），其作用是为客户端提供读服务，如果是写服务则转发给Leader。在选举过程中参与投票；Observe（观察者），其作用是为客户端提供读服务器，如果是写服务则转发给Leader。不参与选举过程中的投票，也不参与“过半写成功”策略。在不影响写性能的情况下提升集群的读性能。此角色于ZooKeeper3.3版本以以后版本的新增角色。Client（客户端） 连接zookeeper服务器的使用着，请求的发起者。独立于zookeeper服务器集群之外的角色。</p><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>&emsp;&emsp;本章将从Hadoop的高可用HA搭建理论，主机的分配和角色分配，软件和硬件准备来进行阐述，做到环境搭建前的准备工作，以便于后面有条不紊的进行。</p><h5 id="搭建理论"><a href="#搭建理论" class="headerlink" title="搭建理论"></a>搭建理论</h5><p>&emsp;&emsp;Hadoop高可用HA的部署，需要有2个NameNode，一个是活跃状态active的，一个是备用状态standby的，两个NameNode需要有一个管理员来协调管理，来决定决定谁处于active状态，谁处于standby状态，如果处于active状态的的NameNode宕机了，立即启动standby状态的NameNode转换为active状态，而这个具有协调功能的管理员就是ZooKeeper。<br>&emsp;&emsp;这样配置一主一从的主备NameNode之间通过一组JournalNode(JournalNode是Hadoop层面的，主流使用JournalNode集群进行数据共享)同步元数据信息，一条数据只要成功写入多数JournalNode即认为写入成功。通常配置奇数个JournalNode。同时为了满足高可用HA，那么，只有一个管理员ZooKeeper也不行，万一这个管理员坏了呢。所以需要配置一个ZooKeeper集群，同样只有一个JournalNode也不行，要配置多个JournalNode。</p><h5 id="角色分配"><a href="#角色分配" class="headerlink" title="角色分配"></a>角色分配</h5><p><strong>集群规划</strong></p><table><thead><tr><th align="center">主机名</th><th align="center">IP地址</th><th align="center">软件安装</th><th align="center">部署后运行的进程</th></tr></thead><tbody><tr><td align="center">master01</td><td align="center">192.168.92.2</td><td align="center">JDK、Hadoop</td><td align="center">NN、RM、ZKFC</td></tr><tr><td align="center">master02</td><td align="center">192.168.92.2</td><td align="center">JDK、Hadoop</td><td align="center">NN、RM、ZKFC</td></tr><tr><td align="center">slave01</td><td align="center">192.168.92.2</td><td align="center">JDK、Hadoop、ZooKeeper</td><td align="center">DN、DM、JN</td></tr><tr><td align="center">slave02</td><td align="center">192.168.92.2</td><td align="center">JDK、Hadoop、ZooKeeper</td><td align="center">DN、DM、JN</td></tr><tr><td align="center">slave03</td><td align="center">192.168.92.2</td><td align="center">JDK、Hadoop、ZooKeeper</td><td align="center">DN、DM、JN</td></tr></tbody></table><p><strong>备注说明：</strong></p><ul><li>192.168.92.1作为这个集群网关的IP地址</li><li>NN：指的是NameNode；DN：指的是DataNode；JN：指的是JournalNode</li><li>RM：指的是ResourceManager；DM：指的是NodeManager</li><li>ZKFC：指的是ZKFailoverController</li></ul><h5 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h5><p><strong>JDK</strong><br><span class="exturl" data-url="aHR0cHM6Ly93d3cub3JhY2xlLmNvbS90ZWNobmV0d29yay9qYXZhL2phdmFzZS9kb3dubG9hZHMvaW5kZXguaHRtbA==" title="https://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle的JDK下载官网点击这里<i class="fa fa-external-link"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9vcGVuamRrLmphdmEubmV0L2luc3RhbGwv" title="https://openjdk.java.net/install/">OpenJDK下载官网点击这里<i class="fa fa-external-link"></i></span><br>jdk-8u201-linux-x64.tar.gz<br><strong>Hadoop</strong><br><span class="exturl" data-url="aHR0cHM6Ly9oYWRvb3AuYXBhY2hlLm9yZy9yZWxlYXNlcy5odG1s" title="https://hadoop.apache.org/releases.html">Apache的Hadoop各个版本下载点击这里<i class="fa fa-external-link"></i></span><br>hadoop-2.7.7.tar.gz<br>hadoop-3.2.0.tar.gz<br><span class="exturl" data-url="aHR0cHM6Ly9hcmNoaXZlLmNsb3VkZXJhLmNvbS9jZGg1L2NkaC81Lw==" title="https://archive.cloudera.com/cdh5/cdh/5/">CDH的Hadoop各个版本下载点击这里<i class="fa fa-external-link"></i></span><br>&emsp;&emsp;在Chrome浏览器中，直接使用快捷键Ctrl+g启动页面搜索，输入hadoop回车即可查找到相关信息。注意版本的匹配问题（Hadoop版本、JDK版本和ZooKeeper版本之间的匹配支持问题）<br>hadoop-2.6.0-cdh5.13.2.tar.gz<br>hadoop-2.5.0-cdh5.2.0.tar.gz<br><strong>ZooKeeper</strong><br><span class="exturl" data-url="aHR0cDovL21pcnJvci5iaXQuZWR1LmNuL2FwYWNoZS96b29rZWVwZXIv" title="http://mirror.bit.edu.cn/apache/zookeeper/">Apache的ZooKeeper各个版本下载点击这里<i class="fa fa-external-link"></i></span><br>apache-zookeeper-3.5.5.tar.gz<br>zookeeper-3.4.14.tar.gz</p><h5 id="硬件准备"><a href="#硬件准备" class="headerlink" title="硬件准备"></a>硬件准备</h5><p><strong>新建主机</strong></p><ul><li>master01——root——password——staticIP——domain——firewalld</li><li>master02——root——password——staticIP——domain——firewalld</li><li>slave01——root——password——staticIP——domain——firewalld</li><li>slave02——root——password——staticIP——domain——firewalld</li><li>slave03——root——password——staticIP——domain——firewalld</li></ul><p><strong>备注说明：</strong><br>&emsp;&emsp;每一台主机配置好登录的用户名和密码，静态IP地址，主机名与IP地址的域名绑定，网卡信息的修改和防火墙的关闭(可以按需要关闭端口，也可以整个关闭防火墙)。<br><strong>配置免密登录</strong><br>&emsp;&emsp;先在每一台主机上执行生成RSA算法的秘钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen –t rsa</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;从master01以root用户登录master01、master02、slave01、slave02、slave03免密。在master01主机上进行一下操作命令即可，其他主机类似操作即可，实现所有主机之间相互免密登录，都是在内部的局域网下，安全问题不考虑，这样操作方便，不需要考虑各个进行之间的通信问题。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@master01</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@master02</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@slave01</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@slave02</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@slave03</span><br></pre></td></tr></table></figure><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p>&emsp;&emsp;本章将从JDK的安装配置，Hadoop的安装配置和ZooKeeper的安装配置来进行阐述，一步一步地按照集群的规划来部署好我们规划中的集群。</p><h5 id="JDK安装"><a href="#JDK安装" class="headerlink" title="JDK安装"></a>JDK安装</h5><p><strong>本节从JDK的下载、解压、环境变量和集群分发方面进行阐述</strong></p><h6 id="下载解压"><a href="#下载解压" class="headerlink" title="下载解压"></a>下载解压</h6><p>&emsp;&emsp;将下载好的jdk版本上传到master01主机上(当前操作所在路径root用户目录下~)，指定解压到/usr/，命令如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf jdk-8u201-linux-x64.tar.gz -C /usr/</span><br></pre></td></tr></table></figure><h6 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h6><p>&emsp;&emsp;编辑系统的环境变量配置，将jdk添加到环境变量中，用vi/vim打开/etc/profile，并添加一下内容，然后保存退出，并重新生效一下环境变量。命令以内容如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> VI/VIM命令</span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 添加一下内容</span><br><span class="line">JAVA_HOME=/home/java/jdk1.8.0_131</span><br><span class="line">JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export JRE_HOME</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 保存退出后重新生效环境变量</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h6 id="集群分发"><a href="#集群分发" class="headerlink" title="集群分发"></a>集群分发</h6><p>配置好master01主机上的JDK后进行集群分发到master02、slave01、slave02和slave03。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp –r /usr/jdk1.8.0_201/ root@master02:/usr/</span><br><span class="line">scp –r /usr/jdk1.8.0_201/root@slave01:/usr/</span><br><span class="line">scp –r /usr/jdk1.8.0_201/root@slave02:/usr/</span><br><span class="line">scp –r /usr/jdk1.8.0_201/root@slave03:/usr/</span><br></pre></td></tr></table></figure><p>分发master01主机上的环境变量配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp –r /etc/profile root@master02:~/</span><br><span class="line">scp –r /etc/profile root@slaver01:~/</span><br><span class="line">scp –r /etc/profile root@slaver02:~/</span><br><span class="line">scp –r /etc/profile root@slaver03:~/</span><br></pre></td></tr></table></figure><h5 id="ZooKeeper安装"><a href="#ZooKeeper安装" class="headerlink" title="ZooKeeper安装"></a>ZooKeeper安装</h5><p><strong>本节从ZooKeeper的下载、解压、环境变量和集群分发方面进行阐述</strong></p><h6 id="下载解压-1"><a href="#下载解压-1" class="headerlink" title="下载解压"></a>下载解压</h6><p>&emsp;&emsp;将下载好的ZooKeeper版本上传到slaver01主机上(当前操作所在路径root用户目录下~)，指定解压到/usr/，命令如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf zookeeper-3.4.14.tar.gz -C /usr/</span><br></pre></td></tr></table></figure><h6 id="环境变量-1"><a href="#环境变量-1" class="headerlink" title="环境变量"></a>环境变量</h6><p>&emsp;&emsp;编辑系统的环境变量配置，将ZooKeeper(ZK)添加到环境变量中，用vi/vim打开/etc/profile，并添加一下内容，然后保存退出，并重新生效一下环境变量。命令以内容如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> VI/VIM命令</span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在末尾添加</span><br><span class="line">export ZOOKEEPER_HOME=/usr/zookeeper-3.4.14</span><br><span class="line">export PATH=$ZOOKEEPER_HOME/bin:$PATH</span><br><span class="line">export PATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 保存退出后重新生效环境变量</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h6 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h6><p>&emsp;&emsp;ZooKeeper的配置文件全部在$ZOOKEEPER_HOME/conf下，首先进入到这里配置文件路径下，然后查看所有的配置文件，对应着一个一个地配置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入ZK配置文件路径</span><br><span class="line">cd $ZKHOME/conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 重命名配置文件</span><br><span class="line">cp zoo_sample.cfg zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 打开配置文件</span><br><span class="line">vim zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改内容</span><br><span class="line">dataDir=$ZKHOME/tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在最后添加内容</span><br><span class="line">server.1=slave01:2888:3888</span><br><span class="line">server.2=slave02:2888:3888</span><br><span class="line">server.3=slave03:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 保存退出后重新生效环境变量</span><br><span class="line">source /etc/profile </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 再在dataDir设置的位置创建一个空文件myid</span><br><span class="line">touch dataDir/myid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 最后向该文件写入唯一ID编码</span><br><span class="line">echo 1 &gt; $ZKHOME/tmp/myid</span><br></pre></td></tr></table></figure><h6 id="集群分发-1"><a href="#集群分发-1" class="headerlink" title="集群分发"></a>集群分发</h6><p>配置好slave01主机上的zookeeper后进行集群分发到slave02和slave03。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 集群分发</span><br><span class="line">scp –r /usr/zookeeper-3.4.14/ root@slave02:/usr/</span><br><span class="line">scp –r /usr/zookeeper-3.4.14/ root@slave03:/usr/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 特别注意：修改slave02、slave03对应dataDir设置的位置/tmp/myid内容</span><br><span class="line"><span class="meta">#</span> 在slave02：</span><br><span class="line">echo 2 &gt; $ZKHOME/tmp/myid</span><br><span class="line"><span class="meta">#</span> slave03：</span><br><span class="line">echo 3 &gt; $ZKHOME/tmp/myid</span><br></pre></td></tr></table></figure><p>分发slaver01主机上的环境变量配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 集群分发</span><br><span class="line">scp –r /etc/profile root@slaver02:~/</span><br><span class="line">scp –r /etc/profile root@slaver03:~/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 可以用命令启动zookeeper</span><br><span class="line">zkServer.sh start来启动</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 用命令来查看三个ZK集群上，哪个是leader，哪两个是follower</span><br><span class="line">zkServer.sh status</span><br></pre></td></tr></table></figure><h5 id="Hadoop安装"><a href="#Hadoop安装" class="headerlink" title="Hadoop安装"></a>Hadoop安装</h5><p><strong>本节从Hadoop的下载、解压、添加环境变量、修改配置文件和集群分发方面进行阐述</strong></p><h6 id="下载解压-2"><a href="#下载解压-2" class="headerlink" title="下载解压"></a>下载解压</h6><p>&emsp;&emsp;将下载好的hadoop版本上传到master01进行解压(当前操作所在路径root用户目录下~)，指定解压到/usr/。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hadoop-2.7.7.tar.gz -C /usr/</span><br></pre></td></tr></table></figure><h6 id="环境变量-2"><a href="#环境变量-2" class="headerlink" title="环境变量"></a>环境变量</h6><p>&emsp;&emsp;用编辑器打开系统环境配置文件，用VI/VIM打开/etc/profile，然后添加一下内容，方便后面直接使用一些hadoop的shell命令，当然也是可以不用配置的，直接找到hadoop的shell命令所在路径，然后再执行shell命令，这样有时候不是很方便。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> vim打开/etc/profile</span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 文件尾部添加内容</span><br><span class="line">export HADOOP_HOME=/usr/hadoop-2.7.7</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure><h6 id="修改配置文件-1"><a href="#修改配置文件-1" class="headerlink" title="修改配置文件"></a>修改配置文件</h6><p>&emsp;&emsp;hadoop2.x的配置文件全部在$HADOOP_HOME/etc/hadoop下，首先进入到这里配置文件路径下，然后查看所有的配置文件，对应着一个一个地配置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 进入hadoop配置文件路径</span><br><span class="line">cd $HADOOP_HOME/etc/hadoop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改hadoop-env.sh</span><br><span class="line">export JAVA_HOME=$JAVA_HOME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改slaves文件，添加如下内容，作用是指定hadoop的datanode节点。</span><br><span class="line">slave01</span><br><span class="line">slave02</span><br><span class="line">slave03</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改mapred-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;!-- 指定mr框架为yarn方式 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;yarn&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p><strong>修改配置文件core-site.xml</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 修改core-site.xml(其他property不改)</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;!-- 指定hdfs的nameservice为mycluster --&gt;</span><br><span class="line">  &lt;!-- mycluster 后面配置hdfs.site要用到 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;mycluster&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定hadoop临时目录 --&gt;</span><br><span class="line">  &lt;!-- 需要提前在指定路径创建好空目录tmp --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;/usr/hadoop-2.7.7/tmp&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定zookeeper地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;slave01:2181,slave02:2181,slave03:2181&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p><strong>修改配置文件hdfs-site.xml</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 修改hdfs-site.xml(其他property不改)</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;!--指定hdfs的nameservice为mycluster需要和core-site.xml中的保持一致 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.nameservices&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;mycluster&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- ns1下面有两个NameNode，分别是nn1，nn2 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.ha.namenodes.mycluster&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master01,master02&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- nn1的RPC通信地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.namenode.rpc-address.mycluster.nn1&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master01:8020&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- nn1的http通信地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.namenode.http-address.mycluster.nn1&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master01:50070&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- nn2的RPC通信地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.namenode.rpc-address.mycluster.nn2&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master02:8020&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- nn2的http通信地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.namenode.http-address.mycluster.nn2&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master02:50070&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定NameNode的元数据在JournalNode上的存放位置 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;qjournal://slave01:8485;slave02:8485;slave03:8485/mycluster&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定JournalNode在本地磁盘存放数据的位置 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;/usr/hadoop-2.7.7/journaldata&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 开启NameNode失败自动切换 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;true&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 配置失败自动切换实现方式 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.client.failover.proxy.provider.mycluster&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;	</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 配置隔离机制方法--&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;sshfence&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 使用sshfence隔离机制时需要ssh免登陆 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;/root/.ssh/id_rsa&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 配置sshfence隔离机制超时时间 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;dfs.ha.fencing.ssh.connect-timeout&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;30000&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p><strong>修改配置文件yarn-site.xml</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 修改yarn-site.xml</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;!-- Site specific YARN configuration properties --&gt;</span><br><span class="line">  &lt;!-- 开启RM高可用 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;true&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定RM的cluster id --&gt;</span><br><span class="line">  &lt;!-- 该cluster-id不能与nameService相同--&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;yrc&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定RM的名字 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;rm1,rm2&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 分别指定RM的地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master01&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;master02&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 启用RM重启的功能--&gt;</span><br><span class="line">  &lt;property&gt;  </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.recovery.enabled&lt;/name&gt;  </span><br><span class="line">    value&gt;true&lt;/value&gt; </span><br><span class="line">  &lt;!--description&gt;启用RM重启的功能，默认为false&lt;/description--&gt;</span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">  </span><br><span class="line">  &lt;property&gt;  </span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.store.class&lt;/name&gt;  </span><br><span class="line">  	&lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore&lt;/value&gt; </span><br><span class="line">  &lt;!--description&gt;用于状态存储的类，采用ZK存储状态类&lt;/description--&gt;</span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">  </span><br><span class="line">  &lt;!-- 指定zk集群地址 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;slave01:2181,slave02:2181,slave03:2181&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property&gt;</span><br><span class="line">  	&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span><br><span class="line">  	&lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.webapp.address.rm1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master:8088&lt;/value&gt;</span><br><span class="line">  &lt;!--description&gt;提供给web页面访问的地址，可以查看任务状况等信息&lt;/description--&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.webapp.address.rm2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;hostbb:8088&lt;/value&gt;</span><br><span class="line">  &lt;!--description&gt;提供给web页面访问的地址，可以查看任务状况等信息&lt;/description--&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- 配置通讯的地址和端口，有多少个RM就配置多少组property --&gt;</span><br><span class="line">  &lt;!-- RM1--&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.scheduler.address.rm1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master01:8030&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master01:8031&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.address.rm1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master01:8032&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.admin.address.rm1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master01:8033&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- RM2 --&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.scheduler.address.rm2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master02:8030&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.resource-tracker.address.rm2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master02:8031&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.address.rm2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master02:8032&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.resourcemanager.admin.address.rm2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master02:8033&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><h6 id="集群分发-2"><a href="#集群分发-2" class="headerlink" title="集群分发"></a>集群分发</h6><p>配置好master01主机上的hadoop后进行集群分发到master02、slave01、slave02和slave03。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp –r /usr/hadoop-2.7.7/ root@master02:/usr/</span><br><span class="line">scp –r /usr/hadoop-2.7.7/root@slave01:/usr/</span><br><span class="line">scp –r /usr/hadoop-2.7.7/root@slave02:/usr/</span><br><span class="line">scp –r /usr/hadoop-2.7.7/root@slave03:/usr/</span><br></pre></td></tr></table></figure><p>分发master01主机上的环境变量配置文件，这个环境变量记得每次配置完成后都要集群分发一次，并重新生效，也可以整个所有集群环境搭建好了之后，只需要集群分发一次并生效即可。</p><h4 id="集群检测"><a href="#集群检测" class="headerlink" title="集群检测"></a>集群检测</h4><h5 id="格式化HDFS"><a href="#格式化HDFS" class="headerlink" title="格式化HDFS"></a>格式化HDFS</h5><p>在master01上执行分布式文件系统HDFS的格式化命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure><p>格式化后会在根据core-site.xml中的hadoop.tmp.dir配置生成个文件，这里我配置的是$HADOOP_HOME/tmp，然后将$HADOOP_HOME/tmp拷贝到#master02的$HADOOP_HOME下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 格式化主从NameNode</span><br><span class="line">scp -r tmp/ master02:$HADOOP_HOME</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 建议使用命令进行主从NameNode格式化</span><br><span class="line"><span class="meta">#</span> 在执行此命令前先启动master01的namenode：sbin/hadoop-daemon.sh start namenode </span><br><span class="line">hdfs namenode -bootstrapStandby</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 格式化ZKFC</span><br><span class="line"><span class="meta">#</span> 格式化ZKFC(在master01上执行即可)</span><br><span class="line">hdfs zkfc -formatZK</span><br><span class="line"><span class="meta">#</span> 或者直接到hadoop的bin和sbin下调相应命令</span><br><span class="line">bin/hdfs zkfc -formatZK</span><br></pre></td></tr></table></figure><h5 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 在zookeeper的三个节点上执行命令启动zookeeper</span><br><span class="line">zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 然后在master01上执行启动HDFS、YARN</span><br><span class="line">start-dfs.sh</span><br><span class="line">start-yarn.sh</span><br></pre></td></tr></table></figure><h5 id="集群检测-1"><a href="#集群检测-1" class="headerlink" title="集群检测"></a>集群检测</h5><p><strong>检测进程</strong><br>&emsp;&emsp;在每一台主机上执行jps命令，查看运行在Java虚拟机KVM的进程。可以采用批量化命令，即打开远程连接软件的交互窗口，只输入一次命令在所有主机上都运行该命令，然后根据每一台主机运行后的进程和我们预先的进程是否一致，若相同则集群成功了。<br><strong>检测浏览器访问</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看分布式文件系统HDFS</span><br><span class="line">http://192.168.92.2:50070</span><br><span class="line">NameNode 'master01:9000' (active)</span><br><span class="line">http://192.168.92.3:50070</span><br><span class="line">NameNode 'master02:9000' (standby)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看分布式资源调度YARN任务信息（ResourceManager运行节点的IP）</span><br><span class="line">http://192.168.92.2:8088(端口号是上面文件中配置的,默认是8088)</span><br></pre></td></tr></table></figure><p><strong>测试集群的高可用性</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 先向hdfs上传一个文件</span><br><span class="line">hadoop fs -put /etc/profile /</span><br><span class="line">hadoop fs -ls /</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 然后再kill掉active的NameNode</span><br><span class="line">kill -9 &lt;pid of NN&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 通过浏览器访问：http://192.168.92.3:50070</span><br><span class="line"><span class="meta">#</span> NameNode 'master02:9000' (active)</span><br><span class="line"><span class="meta">#</span> 这个时候master02上的NameNode变成了active</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在执行命令,发现刚才上传的文件依然存在</span><br><span class="line">hadoop fs -ls /</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 手动启动那个挂掉的NameNode</span><br><span class="line">sbin/hadoop-daemon.sh start namenode</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 通过浏览器访问：http://192.168.92.2:50070</span><br><span class="line">NameNode 'weekend01:9000' (standby)</span><br></pre></td></tr></table></figure><h4 id="出错问题QA"><a href="#出错问题QA" class="headerlink" title="出错问题QA"></a>出错问题QA</h4><p><strong>Q：不能完成主备NameNode节点之间的自动切换？</strong><br>A：查看配置hdfs-site.xml密匙文件位置是否配置正确！</p><p><strong>Q：出现找不到命令的情况？</strong><br>A：看环境变量是否配置好了，或者直接到hadoop的bin和sbin下调相应命令！</p><p><strong>Q：出现访问不了哪一个节点？</strong><br>A：节点之间是要相互通信的，所以要检查在各节点之间配置ssh免密登陆！</p><p><strong>Q：出现找不到主机名错误提示？</strong><br>A：查看主机名与IP的映射域名文件/etc/hosts是否配置准确！注意配置文件/etc/sysconfig/network配置的是该主机的主机名！</p><p><strong>Q：运行过程中出现莫名其妙错误？</strong><br>A：首先应该检查一下集群的必要进程是否还在，有可能莫名其妙的在后台挂掉了！</p><p><strong>Q：浏览器访问出现端口冲突？</strong><br>A：所有进行的HTTP端口或者RPC通信端口采用默认方式，如果有冲突则修改端口即可！</p><p><strong>Q：感觉看到不是很懂的，感觉有错误的？</strong><br>A：首先本篇文章要求读者有一定的Linux基础和Hadoop集群基础，然后可能版本的原因，部分配置信息有不同，详情请以官方配置文档为主！</p></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="\大数据框架Hadoop的前世今生\" rel="bookmark">大数据框架Hadoop的前世今生</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\Hadoop之wordcount实例-MapReduce程序\" rel="bookmark">Hadoop之wordcount实例-MapReduce程序</a></div></li></ul><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读，欢迎分享！-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script><script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script><link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css"><p><span>本文标题:</span>Hadoop的高可用HA部署</p><p><span>文章作者:</span>云主宰苍穹</p><p><span>原始链接:</span><a href="/Hadoop的高可用HA部署/" title="Hadoop的高可用HA部署">https://2694048168.github.io/Hadoop的高可用HA部署/</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://2694048168.github.io/Hadoop的高可用HA部署/" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");clipboard.on("success",$(function(){$(".fa-clipboard").click(function(){swal({title:"",text:"复制成功",html:!1,timer:500,showConfirmButton:!1})})}))</script></div><div id="reward-container"><div></div> <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';"> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.png" alt="云主宰苍穹 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.png" alt="云主宰苍穹 支付宝"><p>支付宝</p></div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Hadoop/" rel="tag"># Hadoop</a></div><div class="post-widgets"><div class="social-share"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/计算机语言简介/" rel="next" title="计算机语言简介"><i class="fa fa-chevron-left"></i> 计算机语言简介</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/TensorFlow简介/" rel="prev" title="TensorFlow简介">TensorFlow简介<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/liwei.jpg" alt="云主宰苍穹"><p class="site-author-name" itemprop="name">云主宰苍穹</p><div class="site-description motion-element" itemprop="description">云主宰苍穹,物联网,嵌入式、云计算、大数据、人工智能、机器学习</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tLzI2OTQwNDgxNjgv" title="GitHub &rarr; https://github.com/2694048168/"><i class="fa fa-fw fa-github"></i> GitHub</span></span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly93ZWliby5jb20vNTk2MzU1MzMwOS8=" title="Weibo &rarr; https://weibo.com/5963553309/"><i class="fa fa-fw fa-weibo"></i> Weibo</span></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <span class="exturl" data-url="aHR0cHM6Ly9hdXRob3IuYmFpZHUuY29tL2hvbWUvMTYyMzY0NDY2NjE2MjYwMS8=" title="https://author.baidu.com/home/1623644666162601/">百家号-专注物联网知识</span></li><li class="links-of-blogroll-item"> <span class="exturl" data-url="aHR0cHM6Ly93d3cudG91dGlhby5jb20vYy91c2VyLzIwMDk1NDExMTY2OTkwNzkv" title="https://www.toutiao.com/c/user/2009541116699079/">头条号-专注物联网知识</span></li><li class="links-of-blogroll-item"> <span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMzYyOTAxODc3Lw==" title="https://space.bilibili.com/362901877/">哔哩哔哩-云主宰苍穹</span></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#理论分析"><span class="nav-number">2.</span> <span class="nav-text">理论分析</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RPC通信机制"><span class="nav-number">2.1.</span> <span class="nav-text">RPC通信机制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hadoop基础理论"><span class="nav-number">2.2.</span> <span class="nav-text">Hadoop基础理论</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ZooKeeper基础理论"><span class="nav-number">2.3.</span> <span class="nav-text">ZooKeeper基础理论</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#准备工作"><span class="nav-number">3.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#搭建理论"><span class="nav-number">3.1.</span> <span class="nav-text">搭建理论</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#角色分配"><span class="nav-number">3.2.</span> <span class="nav-text">角色分配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#软件准备"><span class="nav-number">3.3.</span> <span class="nav-text">软件准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#硬件准备"><span class="nav-number">3.4.</span> <span class="nav-text">硬件准备</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#环境搭建"><span class="nav-number">4.</span> <span class="nav-text">环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#JDK安装"><span class="nav-number">4.1.</span> <span class="nav-text">JDK安装</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#下载解压"><span class="nav-number">4.1.1.</span> <span class="nav-text">下载解压</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#环境变量"><span class="nav-number">4.1.2.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#集群分发"><span class="nav-number">4.1.3.</span> <span class="nav-text">集群分发</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ZooKeeper安装"><span class="nav-number">4.2.</span> <span class="nav-text">ZooKeeper安装</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#下载解压-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">下载解压</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#环境变量-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#修改配置文件"><span class="nav-number">4.2.3.</span> <span class="nav-text">修改配置文件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#集群分发-1"><span class="nav-number">4.2.4.</span> <span class="nav-text">集群分发</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hadoop安装"><span class="nav-number">4.3.</span> <span class="nav-text">Hadoop安装</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#下载解压-2"><span class="nav-number">4.3.1.</span> <span class="nav-text">下载解压</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#环境变量-2"><span class="nav-number">4.3.2.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#修改配置文件-1"><span class="nav-number">4.3.3.</span> <span class="nav-text">修改配置文件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#集群分发-2"><span class="nav-number">4.3.4.</span> <span class="nav-text">集群分发</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#集群检测"><span class="nav-number">5.</span> <span class="nav-text">集群检测</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#格式化HDFS"><span class="nav-number">5.1.</span> <span class="nav-text">格式化HDFS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启动集群"><span class="nav-number">5.2.</span> <span class="nav-text">启动集群</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#集群检测-1"><span class="nav-number">5.3.</span> <span class="nav-text">集群检测</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#出错问题QA"><span class="nav-number">6.</span> <span class="nav-text">出错问题QA</span></a></li></ol></div></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span><span class="with-love" id="animate"><i class="fa fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder">云主宰苍穹</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">152k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">2:18</span></div><div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> 强力驱动 v3.9.0</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZw==">NexT.Pisces</span> v7.3.0</div><div class="busuanzi-count"><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i> 访问用户：<span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人</span><div class="powered-by"></div><span class="site-uv"><i class="fa fa-eye"></i> 访问次数：<span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div><script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>pbOptions={iconStyle:"box",boxForm:"horizontal",position:"bottomCenter",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"box",boxForm:"horizontal",position:"middleRight",networks:"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script></div><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script><script src="/js/utils.js?v=7.3.0"></script><script src="/js/affix.js?v=7.3.0"></script><script src="/js/schemes/pisces.js?v=7.3.0"></script><script src="/js/next-boot.js?v=7.3.0"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js?v=7.3.0"></script><script src="/js/scrollspy.js?v=7.3.0"></script><script src="/js/post-details.js?v=7.3.0"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css"><script>NexT.utils.getScript("//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js",function(){new Gitalk({clientID:"aebff323e44f1516e521",clientSecret:"3934128e2a234e13b6118386667dee31ab703836",repo:"2694048168.github.io",owner:"2694048168",admin:["2694048168"],id:"16b80e03957cb6045f31bfe2a6b04b46",language:"en | es-ES | fr | ru | zh-CN | zh-TW",distractionFreeMode:"true"}).render("gitalk-container")},window.Gitalk)</script></body></html>